apiVersion: v1
kind: ServiceAccount
metadata:
  name: multus
  namespace: kube-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: multus
rules:
  # 读取 Pod/Namespace（multus 需要读 pod annotations）
  - apiGroups: [""]
    resources: ["pods", "pods/status", "namespaces"]
    verbs: ["get", "list", "watch"]

  # 写入 networks-status（很多部署会 patch pod 注解；不给 patch 有些版本会失败或无状态）
  - apiGroups: [""]
    resources: ["pods"]
    verbs: ["patch", "update"]

  # 读取 NetworkAttachmentDefinition（multus 需要读 NAD）
  - apiGroups: ["k8s.cni.cncf.io"]
    resources: ["network-attachment-definitions"]
    verbs: ["get", "list", "watch"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: multus
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: multus
subjects:
  - kind: ServiceAccount
    name: multus
    namespace: kube-system
